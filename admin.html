<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="noindex, nofollow">
    <title>Admin | Ryans Web Services</title>
    <link rel="icon" type="image/png" sizes="32x32" href="favicon_io/favicon-32x32.png">
    <link rel="stylesheet" href="css/admin.css">
</head>
<body class="admin-body">

    <div id="loginScreen" class="admin-login">
        <div class="admin-login-card">
            <div class="admin-login-logo">
                <h1>Admin Portal</h1>
                <p>Sign in to access the dashboard</p>
            </div>
            <div id="loginError" class="admin-login-error"></div>
            <form id="adminLoginForm">
                <div class="form-group">
                    <label for="adminEmail">Email</label>
                    <input type="email" id="adminEmail" required placeholder="admin@example.com">
                </div>
                <div class="form-group">
                    <label for="adminPassword">Password</label>
                    <input type="password" id="adminPassword" required placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                </div>
                <button type="submit" class="admin-login-btn">Sign In</button>
            </form>
        </div>
    </div>

    <div id="adminDashboard" class="admin-wrapper" style="display: none;">
        <div class="sidebar-overlay" id="sidebarOverlay"></div>

        <aside class="admin-sidebar" id="adminSidebar">
            <div class="sidebar-brand">
                <h1>RWS Admin</h1>
            </div>

            <div class="sidebar-user">
                <div class="sidebar-user-avatar" id="sidebarUserAvatar">A</div>
                <div class="sidebar-user-info">
                    <div class="sidebar-user-name" id="sidebarUserName">Admin</div>
                    <div class="sidebar-user-role">Administrator</div>
                </div>
            </div>

            <nav class="sidebar-nav">
                <div class="sidebar-section">
                    <div class="sidebar-section-title">Dashboard</div>
                    <button class="sidebar-link active" data-section="overview">
                        <span class="sidebar-link-icon">üìä</span>
                        Overview
                    </button>
                </div>

                <div class="sidebar-section">
                    <div class="sidebar-section-title">Management</div>
                    <button class="sidebar-link" data-section="analytics">
                        <span class="sidebar-link-icon">üìà</span>
                        Analytics
                    </button>
                    <button class="sidebar-link" data-section="users">
                        <span class="sidebar-link-icon">üë•</span>
                        Users
                    </button>
                    <button class="sidebar-link" data-section="requests">
                        <span class="sidebar-link-icon">üìã</span>
                        Service Requests
                    </button>
                    <button class="sidebar-link" data-section="quotes">
                        <span class="sidebar-link-icon">üé´</span>
                        Custom Quotes
                    </button>
                    <button class="sidebar-link" data-section="payments">
                        <span class="sidebar-link-icon">üí≥</span>
                        Payments
                    </button>
                    <button class="sidebar-link" data-section="files">
                        <span class="sidebar-link-icon">üìÅ</span>
                        Files
                    </button>
                </div>

                <div class="sidebar-section">
                    <div class="sidebar-section-title">Communication</div>
                    <button class="sidebar-link" data-section="messages">
                        <span class="sidebar-link-icon">üí¨</span>
                        Messages
                    </button>
                    <button class="sidebar-link" data-section="contacts">
                        <span class="sidebar-link-icon">üì¨</span>
                        Contact Forms
                    </button>
                    <button class="sidebar-link" data-section="updates">
                        <span class="sidebar-link-icon">üì¢</span>
                        Updates
                    </button>
                </div>
            </nav>

            <div class="sidebar-footer">
                <button class="sidebar-logout" onclick="adminPanel.handleLogout()">
                    Sign Out
                </button>
            </div>
        </aside>

        <main class="admin-main">
            <header class="admin-header">
                <button class="admin-menu-toggle" id="mobileMenuBtn">‚ò∞</button>
                <div class="admin-header-actions">
                    <button class="admin-btn admin-btn-secondary" id="reloadBtn">Refresh</button>
                </div>
            </header>

            <div class="admin-content">
                <!-- Overview -->
                <section class="admin-section active" id="section-overview">
                    <h2>Dashboard Overview</h2>
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-card-value" id="totalUsers">0</div>
                            <div class="stat-card-label">Total Users</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-card-value" id="totalRevenue">$0</div>
                            <div class="stat-card-label">Total Revenue</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-card-value" id="totalRequests">0</div>
                            <div class="stat-card-label">Service Requests</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-card-value" id="totalFiles">0</div>
                            <div class="stat-card-label">Files Stored</div>
                        </div>
                    </div>
                    <div class="admin-card">
                        <div class="admin-card-header">
                            <div class="admin-card-title">Recent Activity</div>
                        </div>
                        <div id="recentActivityContainer">Loading...</div>
                    </div>
                </section>

                <!-- Analytics -->
                <section class="admin-section" id="section-analytics">
                    <h2>Visitor Analytics</h2>
                    <div style="margin-bottom: 1rem;">
                        <select class="admin-btn admin-btn-secondary" id="analyticsDateRange" onchange="adminPanel.loadAnalytics()" style="padding: 0.5rem;">
                            <option value="1">Today</option>
                            <option value="7" selected>Last 7 Days</option>
                            <option value="30">Last 30 Days</option>
                            <option value="90">Last 90 Days</option>
                        </select>
                    </div>
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-card-value" id="totalPageViews">0</div>
                            <div class="stat-card-label">Page Views</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-card-value" id="uniqueVisitors">0</div>
                            <div class="stat-card-label">Unique Visitors</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-card-value" id="avgTimeOnSite">0s</div>
                            <div class="stat-card-label">Avg. Time on Site</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-card-value" id="bounceRate">0%</div>
                            <div class="stat-card-label">Bounce Rate</div>
                        </div>
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1rem;">
                        <div class="admin-card">
                            <div class="admin-card-title">Top Pages</div>
                            <div id="topPagesContainer">Loading...</div>
                        </div>
                        <div class="admin-card">
                            <div class="admin-card-title">Top Locations</div>
                            <div id="topLocationsContainer">Loading...</div>
                        </div>
                    </div>
                    <div class="admin-card">
                        <div class="admin-card-title">Recent Visitors</div>
                        <div style="overflow-x: auto;">
                            <table class="admin-table">
                                <thead>
                                    <tr>
                                        <th>Time</th>
                                        <th>Page</th>
                                        <th>Location</th>
                                        <th>Device</th>
                                    </tr>
                                </thead>
                                <tbody id="visitorsTableBody">
                                    <tr><td colspan="4">Loading...</td></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </section>

                <!-- Users -->
                <section class="admin-section" id="section-users">
                    <h2>User Management</h2>
                    <div class="admin-card">
                        <div id="usersTableContainer">Loading...</div>
                    </div>
                </section>

                <!-- Requests -->
                <section class="admin-section" id="section-requests">
                    <h2>Service Requests</h2>
                    <div class="admin-card">
                        <div id="requestsTableContainer">Loading...</div>
                    </div>
                </section>

                <!-- Quotes -->
                <section class="admin-section" id="section-quotes">
                    <h2>Custom Quotes</h2>
                    <div style="margin-bottom: 1rem;">
                        <button class="admin-btn admin-btn-primary" id="createQuoteBtn">+ New Quote</button>
                    </div>
                    <div class="admin-card">
                        <div id="quotesTableContainer">Loading...</div>
                    </div>
                </section>

                <!-- Payments -->
                <section class="admin-section" id="section-payments">
                    <h2>Payments</h2>
                    <div class="admin-card">
                        <div id="paymentsTableContainer">Loading...</div>
                    </div>
                </section>

                <!-- Files -->
                <section class="admin-section" id="section-files">
                    <h2>Files</h2>
                    <div style="margin-bottom: 1rem;">
                        <button class="admin-btn admin-btn-primary" id="uploadFileBtn">+ Upload File</button>
                    </div>
                    <div class="admin-card">
                        <div id="filesTableContainer">Loading...</div>
                    </div>
                </section>

                <!-- Messages -->
                <section class="admin-section" id="section-messages">
                    <h2>Messages</h2>
                    <div class="admin-card" style="display: grid; grid-template-columns: 280px 1fr; min-height: 500px;">
                        <div style="border-right: 1px solid var(--border); overflow-y: auto;" id="conversationsList">
                            Loading...
                        </div>
                        <div style="display: flex; flex-direction: column;">
                            <div style="padding: 1rem; border-bottom: 1px solid var(--border);">
                                <strong id="adminChatUserName">Select a conversation</strong>
                                <div style="font-size: 0.8rem; color: var(--text-muted);" id="adminChatUserEmail"></div>
                            </div>
                            <div style="flex: 1; overflow-y: auto; padding: 1rem;" id="adminChatMessages"></div>
                            <div style="padding: 1rem; border-top: 1px solid var(--border); display: flex; gap: 0.5rem;">
                                <input type="text" id="adminMessageInput" placeholder="Type a message..." style="flex: 1; padding: 0.5rem; border: 1px solid var(--border); border-radius: 4px;">
                                <button class="admin-btn admin-btn-primary" id="adminSendBtn">Send</button>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Contacts -->
                <section class="admin-section" id="section-contacts">
                    <h2>Contact Submissions</h2>
                    <div class="admin-card">
                        <div id="contactsTableContainer">Loading...</div>
                    </div>
                </section>

                <!-- Updates -->
                <section class="admin-section" id="section-updates">
                    <h2>Site Updates</h2>
                    <div style="margin-bottom: 1rem;">
                        <button class="admin-btn admin-btn-primary" id="createUpdateBtn">+ New Update</button>
                    </div>
                    <div class="admin-card">
                        <div id="updatesContainer">Loading...</div>
                    </div>
                </section>
            </div>
        </main>
    </div>

    <!-- Upload Modal -->
    <div id="uploadModal" class="modal-overlay" style="display: none;">
        <div class="modal">
            <div class="modal-header">
                <h3>Upload File</h3>
                <button class="modal-close" onclick="document.getElementById('uploadModal').style.display='none'">&times;</button>
            </div>
            <div class="modal-body">
                <form id="uploadFileForm">
                    <div class="form-group">
                        <label>Select User</label>
                        <select id="userSelect" required style="width: 100%; padding: 0.5rem; border: 1px solid var(--border); border-radius: 4px;"></select>
                    </div>
                    <div class="form-group">
                        <label>File Name</label>
                        <input type="text" id="fileName" required placeholder="Document name" style="width: 100%; padding: 0.5rem; border: 1px solid var(--border); border-radius: 4px;">
                    </div>
                    <div class="form-group">
                        <label>File</label>
                        <input type="file" id="fileUpload" required>
                    </div>
                    <div class="form-group">
                        <label>Description</label>
                        <textarea id="fileDescription" rows="2" placeholder="Brief description..." style="width: 100%; padding: 0.5rem; border: 1px solid var(--border); border-radius: 4px;"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="admin-btn admin-btn-secondary" onclick="document.getElementById('uploadModal').style.display='none'">Cancel</button>
                <button class="admin-btn admin-btn-primary" type="submit" form="uploadFileForm">Upload</button>
            </div>
        </div>
    </div>

    <!-- Quote Modal -->
    <div id="quoteModal" class="modal-overlay" style="display: none;">
        <div class="modal" style="max-width: 550px;">
            <div class="modal-header">
                <h3 id="quoteModalTitle">Create Quote</h3>
                <button class="modal-close" onclick="adminPanel.closeQuoteModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div id="generatedCodeDisplay" style="display: none; background: rgba(201, 151, 63, 0.1); border: 1px solid var(--accent); padding: 1rem; border-radius: 4px; text-align: center; margin-bottom: 1rem;">
                    <div style="font-size: 0.75rem; color: var(--text-muted); text-transform: uppercase;">Quote Code</div>
                    <div id="generatedCode" style="font-size: 1.5rem; font-weight: 700; font-family: monospace;"></div>
                    <button class="admin-btn admin-btn-secondary" style="margin-top: 0.5rem; font-size: 0.75rem;" onclick="adminPanel.copyQuoteCode(document.getElementById('generatedCode').textContent)">Copy</button>
                </div>
                <form id="quoteForm">
                    <div class="form-group">
                        <label>Client Name</label>
                        <input type="text" id="quoteClientName" placeholder="John Doe" style="width: 100%; padding: 0.5rem; border: 1px solid var(--border); border-radius: 4px;">
                    </div>
                    <div class="form-group">
                        <label>Client Email</label>
                        <input type="email" id="quoteClientEmail" placeholder="john@example.com" style="width: 100%; padding: 0.5rem; border: 1px solid var(--border); border-radius: 4px;">
                    </div>
                    <div class="form-group">
                        <label>Client Phone</label>
                        <input type="tel" id="quoteClientPhone" placeholder="(555) 123-4567" style="width: 100%; padding: 0.5rem; border: 1px solid var(--border); border-radius: 4px;">
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                        <div class="form-group">
                            <label>Upfront Cost *</label>
                            <input type="number" id="quoteUpfrontCost" placeholder="500" min="0" step="0.01" required style="width: 100%; padding: 0.5rem; border: 1px solid var(--border); border-radius: 4px;">
                        </div>
                        <div class="form-group">
                            <label>Monthly Fee</label>
                            <input type="number" id="quoteMonthlyFee" placeholder="50" min="0" step="0.01" style="width: 100%; padding: 0.5rem; border: 1px solid var(--border); border-radius: 4px;">
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Service Type</label>
                        <select id="quoteServiceType" style="width: 100%; padding: 0.5rem; border: 1px solid var(--border); border-radius: 4px;">
                            <option value="website">Website Design</option>
                            <option value="maintenance">Maintenance</option>
                            <option value="custom">Custom Project</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Valid Until</label>
                        <input type="date" id="quoteValidUntil" style="width: 100%; padding: 0.5rem; border: 1px solid var(--border); border-radius: 4px;">
                    </div>
                    <div class="form-group">
                        <label>Description</label>
                        <textarea id="quoteServiceDescription" rows="2" placeholder="What's included..." style="width: 100%; padding: 0.5rem; border: 1px solid var(--border); border-radius: 4px;"></textarea>
                    </div>
                    <div class="form-group">
                        <label>Notes</label>
                        <textarea id="quoteInternalNotes" rows="2" placeholder="Internal notes..." style="width: 100%; padding: 0.5rem; border: 1px solid var(--border); border-radius: 4px;"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="admin-btn admin-btn-secondary" onclick="adminPanel.closeQuoteModal()">Cancel</button>
                <button class="admin-btn admin-btn-primary" onclick="adminPanel.saveQuote()">Save Quote</button>
            </div>
        </div>
    </div>

    <!-- Update Modal -->
    <div id="updateModal" class="modal-overlay" style="display: none;">
        <div class="modal" style="max-width: 650px;">
            <div class="modal-header">
                <h3 id="updateModalTitle">Create Update</h3>
                <button class="modal-close" onclick="adminPanel.closeUpdateModal()">&times;</button>
            </div>
            <div class="modal-body">
                <form id="updateForm">
                    <input type="hidden" id="updateId">
                    <div class="form-group">
                        <label>Title *</label>
                        <input type="text" id="updateTitle" placeholder="What's happening?" required style="width: 100%; padding: 0.75rem; border: 1px solid var(--border); border-radius: 4px; font-size: 1rem;">
                    </div>
                    
                    <div class="form-group">
                        <label>Content *</label>
                        <div style="border: 1px solid var(--border); border-radius: 4px; overflow: hidden;">
                            <div style="display: flex; gap: 0.25rem; padding: 0.5rem; background: var(--bg-alt); border-bottom: 1px solid var(--border);">
                                <button type="button" class="editor-btn" onclick="adminPanel.formatText('bold')" title="Bold"><b>B</b></button>
                                <button type="button" class="editor-btn" onclick="adminPanel.formatText('italic')" title="Italic"><i>I</i></button>
                                <button type="button" class="editor-btn" onclick="adminPanel.formatText('underline')" title="Underline"><u>U</u></button>
                                <span style="width: 1px; background: var(--border); margin: 0 0.25rem;"></span>
                                <button type="button" class="editor-btn" onclick="adminPanel.formatText('link')" title="Add Link">üîó</button>
                                <button type="button" class="editor-btn" onclick="adminPanel.formatText('list')" title="Bullet List">‚Ä¢</button>
                            </div>
                            <div id="updateContent" contenteditable="true" style="min-height: 150px; padding: 0.75rem; outline: none; font-size: 0.95rem; line-height: 1.6;" placeholder="Write your update here..."></div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Image (optional)</label>
                        <div style="border: 2px dashed var(--border); border-radius: 4px; padding: 1.5rem; text-align: center; cursor: pointer; transition: 0.2s;" id="imageDropZone" onclick="document.getElementById('updateImage').click()">
                            <input type="file" id="updateImage" accept="image/*" style="display: none;" onchange="adminPanel.previewUpdateImage(this)">
                            <div id="imagePreview" style="display: none; margin-bottom: 0.5rem;">
                                <img id="previewImg" style="max-width: 100%; max-height: 200px; border-radius: 4px;">
                                <button type="button" class="admin-btn admin-btn-danger" style="margin-top: 0.5rem; font-size: 0.75rem;" onclick="event.stopPropagation(); adminPanel.removeUpdateImage()">Remove Image</button>
                            </div>
                            <div id="imagePlaceholder">
                                <div style="font-size: 2rem; margin-bottom: 0.5rem;">üì∑</div>
                                <div style="color: var(--text-muted); font-size: 0.875rem;">Click or drag to add an image</div>
                            </div>
                        </div>
                        <input type="hidden" id="updateImageUrl">
                    </div>

                    <div class="form-group">
                        <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                            <input type="checkbox" id="updatePublished" checked>
                            Publish immediately
                        </label>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="admin-btn admin-btn-secondary" onclick="adminPanel.closeUpdateModal()">Cancel</button>
                <button class="admin-btn admin-btn-primary" onclick="adminPanel.saveUpdate()">Post Update</button>
            </div>
        </div>
    </div>

    <!-- Refund Modal -->
    <div id="refundModal" class="modal-overlay" style="display: none;">
        <div class="modal" style="max-width: 400px;">
            <div class="modal-header">
                <h3>Issue Refund</h3>
                <button class="modal-close" onclick="adminPanel.closeRefundModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div style="margin-bottom: 1rem; padding: 1rem; background: var(--bg-alt); border-radius: 4px;">
                    <p><strong>Customer:</strong> <span id="refundCustomer"></span></p>
                    <p><strong>Service:</strong> <span id="refundService"></span></p>
                    <p><strong>Amount:</strong> <span id="refundOriginalAmount"></span></p>
                </div>
                <div class="form-group">
                    <label>Refund Type</label>
                    <select id="refundType" onchange="adminPanel.toggleRefundAmount()" style="width: 100%; padding: 0.5rem; border: 1px solid var(--border); border-radius: 4px;">
                        <option value="full">Full Refund</option>
                        <option value="partial">Partial Refund</option>
                    </select>
                </div>
                <div class="form-group" id="partialAmountGroup" style="display: none;">
                    <label>Refund Amount ($)</label>
                    <input type="number" id="refundAmount" placeholder="0.00" min="0.01" step="0.01" style="width: 100%; padding: 0.5rem; border: 1px solid var(--border); border-radius: 4px;">
                </div>
                <div class="form-group">
                    <label>Reason</label>
                    <select id="refundReason" style="width: 100%; padding: 0.5rem; border: 1px solid var(--border); border-radius: 4px;">
                        <option value="requested_by_customer">Requested by customer</option>
                        <option value="duplicate">Duplicate charge</option>
                        <option value="fraudulent">Fraudulent</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="admin-btn admin-btn-secondary" onclick="adminPanel.closeRefundModal()">Cancel</button>
                <button class="admin-btn admin-btn-danger" onclick="adminPanel.processRefund()">Process Refund</button>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="js/admin.js"></script>
</body>
</html>
